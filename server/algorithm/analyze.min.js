function download(r,o){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(o)),e.setAttribute("download",r),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function createArray(r){for(var o=new Array(r),e=0;e<r;e++)o[e]=!1;return o}function average(r,o,e){var a=0,t=0;for(var n of r)a+=o[n].bbox[e],t++;return a/t}function DFS(r,o){for(var e=o.length,a=createArray(e),t=0;t<e;t++)if(!a[t]){a[t]=!0;for(var n=[t],f=[t];0!=n.length;)for(var b=n.pop(),v=0;v<e;v++)o[b][v]&&!a[v]&&(n.push(v),f.push(v),a[v]=!0);r.push(f)}}function get_bboxes_from_symbols(r,o){"symbol"==r.type?o.push(r):(get_bboxes_from_symbols(r.lchild,o),get_bboxes_from_symbols(r.rchild,o))}function DFS_vertical(r,o,e){for(var a=e.length,t=createArray(a),n=0;n<r.length;n++)for(var f of r[n])if(!t[f]){t[f]=!0;for(var b=[f],v=[f];0!=b.length;)for(var i=b.pop(),h=0;h<a;h++)e[i][h]&&!t[h]&&(b.push(h),v.push(h),t[h]=!0);o.push(v)}}function get_horizontal(r,o,e){for(var a=r.length,t=createArray(a),n=function(o,e){return r[o].bbox.X+.5*r[o].bbox.w<r[e].bbox.X+.5*r[e].bbox.w?-1:1},f=0;f<a;f++)t[f]=createArray(a);for(f=0;f<a;f++)for(var b=f+1;b<a;b++){overlap(r,f,b,"Y")>e&&(t[f][b]=!0)}for(var v of(DFS(o,t),o))v.sort(n);o.sort(function(o,e){return average(o,r,"Y")+.5*average(o,r,"h")<average(e,r,"Y")+.5*average(e,r,"h")?-1:1})}function get_horizontal1(r,o,e){var a=r.length,t=average(Array.from(Array(a).keys()),boxes,"h");for(bbox=0;bbox<a;bbox++)if(0==o.length)o.push([bbox]);else{var n=!0;for(var f of o){var b=!0;for(var v of f){var i=r[bbox].bbox.Y-r[v].bbox.Y+.5*r[bbox].bbox.h-.5*r[v].bbox.h;if(Math.abs(i/t)>e||bbox==v){b=!1;break}}b&&(n=!1,f.push(bbox))}n&&o.push([bbox])}}function get_vertical(r,o,e){for(var a=r.length,t=new Array(a),n=new Array(a),f=function(r){for(var o in r){var e=r[o];if(-1!=e[0]||-1!=e[1])return!0}return!1},b=function(r,o){for(var e in r){o[e]&&(r[e][0]=-1,r[e][1]=-1);for(var a=0;a<r[e].length;a++){var t=r[e][a];-1!=t&&o[t.toString()]&&(r[e][a]=-1)}}},v=0;v<a;v++)t[v]=new Array(a),n[v]=new Array;for(v=0;v<a;v++)for(var i=v;i<a;i++){var h=r[v].bbox,u=r[i].bbox,l=h.X+.5*h.w-u.X-.5*u.w,c=h.Y+.5*h.h-u.Y-.5*u.h;0==l&&(l=1);var g=Number(Math.abs(c/l).toFixed(3));t[v][i]=g,t[i][v]=t[v][i],n[v][i]=!1,n[i][v]=!1}for(var x=0;x<o.length-1;x++)for(var s=x+1;s<o.length;s++){var m=match(r,o[x],o[s],t),p=match(r,o[s],o[x],t),_={};for(var y in m)_[y]=!1;for(var y in p)_[y]=!1;for(;f(m);)for(var d in m){var w=m[d][0];-1==w&&(w=m[d][1]);var A=-1;-1!=w&&-1==(A=p[w.toString()][0])&&(A=p[w.toString()][1]),-1!=w&&-1!=A&&Number(d)==A&&(n[Number(d)][w]=!0,_[d]=!0,_[w.toString()]=!0),b(m,_),b(p,_)}}delete_edges(o,n),DFS_vertical(o,e,n),e.sort(function(o,e){return average(o,r,"X")+.5*average(o,r,"w")<average(e,r,"X")+.5*average(e,r,"w")?-1:1})}function max_two(r,o){var e=-1/0,a=-1,t=-1/0,n=-1;for(var f of r)o[f]>e?(t=e,n=a,e=o[f],a=f):o[f]<e&&o[f]>t&&(t=o[f],n=f);return[a,n]}function interval_overlap(r,o,e){var a,t=r[o].bbox.X,n=t+r[o].bbox.w,f=r[e].bbox.X,b=f+r[e].bbox.w,v=r[o].bbox.h,i=r[e].bbox.h;(n-t)/v<.3&&(t-=a=(.7*v-(n-t))/2,n+=a);(b-f)/i<.3&&(f-=a=(.7*i-(b-f))/2,b+=a);if(f>=n||t>=b)return 0;var h=Math.max(t,f);return 2*(Math.min(n,b)-h)/(n-t+b-f)}function match(r,o,e,a){var t={};for(var n of o){for(var f=max_two(e,a[n]),b=0;b<f.length;b++)-1!=f[b]&&0==interval_overlap(r,n,f[b])&&(f[b]=-1);t[n.toString()]=f}return t}function get_column(r,o){for(var e=[],a=0;a<r.length;a++)e.push(r[a][o]);return e}function delete_edges(r,o){for(var e={},a=0;a<r.length;a++)for(var t of r[a])e[""+t]=a;for(a=0;a<o.length;a++){for(var n=get_column(o,a),f=o[a],b=1/0,v=1/0,i=0;i<n.length;i++){if(n[i])(h=e[""+a]-e[""+i])<b&&(b=h)}for(i=0;i<f.length;i++){if(f[i])(h=e[""+i]-e[""+a])<v&&(v=h)}for(i=0;i<n.length;i++){if(n[i])(h=e[""+a]-e[""+i])!=b&&(o[i][a]=!1)}for(i=0;i<f.length;i++){var h;if(f[i])(h=e[""+i]-e[""+a])!=v&&(o[a][i]=!1)}}}function print(r,o){for(var e of r){var a="";for(var t of e){var n=o[t].label;n||(n=o[t].type),a+=n+"  "}console.log(a)}}function strokesToScg(r){var o="SCG_INK\n"+r.length+"\n";return r.forEach(function(r){o+=r.length+"\n",r.forEach(function(r){o+=r[0]+" "+r[1]+"\n"})}),o}function get_bboxes_from_strokes(r){for(var o=[],e=0;e<r.length;e++){var a=r[e],t=1/0,n=-1/0,f=1/0,b=-1/0;for(var v of a)v[0]<t&&(t=v[0]),v[0]>n&&(n=v[0]),v[1]<f&&(f=v[1]),v[1]>b&&(b=v[1]);o.push({bbox:{X:t,Y:f,w:n-t,h:b-f}})}return o}function overlap(r,o,e,a){var t;"X"==a?t="w":"Y"==a&&(t="h");var n=r[o].bbox,f=r[e].bbox,b=n[a],v=n[a]+n[t],i=f[a],h=f[a]+f[t],u=n[t]+f[t];if(v<i)return(i-v)/(i-v+u)-1;if(h<b)return(b-h)/(b-h+u)-1;var l=Math.min(v,h)-Math.max(b,i);return v-b==0||h-i==0?1:Math.max(l/(v-b==0?1:v-b),l/(h-i==0?1:h-i))}function checkSpecial(r,o){return r[o].bbox.w/r[o].bbox.h>5?"long":"normal"}function remainPercentage(r,o,e){var a=r[o].bbox,t=r[e].bbox,n=a.Y,f=a.Y+a.h,b=t.Y,v=t.Y+t.h,i=Math.max(f,v)-Math.min(n,b);return n<b?-1:(f-n)/i}function divideStrokes(r,o,e,a){for(var t=r.length,n=createArray(t),f=0;f<t;f++)n[f]=createArray(t);for(f=0;f<t;f++)for(var b=f+1;b<t;b++){var v=overlap(r,f,b,"Y"),i=remainPercentage(r,f,b),h=remainPercentage(r,b,f);(v>e||i>a||h>a)&&(n[f][b]=!0)}DFS(o,n)}